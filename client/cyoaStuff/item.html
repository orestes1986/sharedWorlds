<template name="cyoaItem">
	<div class="css-black-bg">
	</div>
	<div class="container top-margin">
		<div class="row">
			<div class="col-md-12">
				{{> cyoaMeta}}
			</div>
		{{>pageItem}}
		{{>paramlist}}
		{{> addParam}}
		{{>cyoaParams}}
		{{>param_add_form}}
		{{>param_edit_form}}
		{{>page_add_form}}
		{{>list_of_pages_form}}
		</div>
		{{> addPage}}
	</div>
</template>
<template name="cyoaMeta">
	{{#with activeWorld}}
		<h2><a href="/worlds/{{_id}}" class="css-cyoa-world-link">{{title}}</a></h2>
		<p>
			World's owner: <a href="/account/{{owner}}" class="css-link">{{ownerUserName}}</a>
		</p>
	{{/with}}
	{{#with adventures}}
		<h1 style="color:#999;">{{> editableText collection="cyoas" field="title"}}</h1>
		<p>
			Adventure's owner: <a href="/account/{{owner}}" class="css-link">{{ownerUserName}}</a>
		</p>
		<a href="/cyoas/{{_id}}/list">Show all pages</a>
	{{/with}}
<!-- 	<h1 style="color:white;">{{> editableText collection="cyoas" field="title"}}</h1> -->
</template>
<template name="cyoaParams">
{{#each params}}
	{{title}}
{{/each}}
</template>

<template name="addParam">
{{#if currentUser}}
	<button class="btn btn-lg css-adding-btn glyphicon glyphicon-plus js-show-page-form" aria-hidden="true" id="add-param-btn" title="Add Parameter">
	</button>
	{{/if}}
	<a href="#" class="js-add-page">
	</a>
</template>

<template name="param_add_form">
	<div class="modal fade" id="param_add_form">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<div class="modal-title">
					</div>
				</div>
				<div class="modal-body">
					<div class="form-group">
							{{#basicFormBlock schema=schema action=action}}
								<p> {{> basicInput field="title"}} </p>
								<div class="form-group">
									<button type="submit" id="submit_doc" class="btn btn-primary" disabled="{{disableButtons}}">Submit</button>
<!-- 									<button type="submit" id="submit_cyoa" class="btn btn-primary" disabled="{{disableButtons}}">Create a CYOA</button> -->
								</div>
							{{/basicFormBlock}}
					</div>
				</div>
			</div>
		</div>
	</div>
</template>
<!--<template name="param_add_form">
	<div class="modal fade" id="param_add_form">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-body">
					<div class="form-group">
						{{#autoForm id="insertParamForm" collection="CyoaParams" type="insert"}}
								{{> afQuickField name="title"}}-->
<!-- 								meteormethod="addParam" -->
<!-- 								{{> afQuickField name="data"}} -->
							<!--	{{> afQuickField name="data"}} label="Data-value"}} label="Data-title"}}
								{{> afQuickField name="data-value"}}-->
<!--								{{> afQuickField name="cyoaid" value=cyoa_id}}
								{{> afQuickField name="pageid" value=page_id}}
								{{> afQuickField name="owner" value=owner}}
								<div class="form-group">
									<button type="submit" class="btn btn-primary js-btn" disabled="{{disableButtons}}">Submit</button>
								</div>
							{{/autoForm}}
					</div>
				</div>
			</div>
		</div>
	</div>
</template>-->
<template name="param_edit_form">
	<div class="modal fade" id="param_edit_form">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-body">
					<div class="form-group">
						{{#with param}}
							<h1>{{> editableText collection="cyoaParams" field="title"}}
							<a href="#" data-data-index="{{data_index}}" class="glyphicon glyphicon-minus js-remove-param" style="color:red;"></a></h1>
							{{#each data}}
								{{#let data_index=@index}} <!--  context=.. -->
									<div>
										<a href="#" data-data-index="{{data_index}}" class="glyphicon glyphicon-minus js-remove-data" style="color:red;"></a>
										{{> editableText context=.. collection='cyoaParams' field=(get_name data_index)}}: 
										<a href="#" data-data-index="{{data_index}}" class="glyphicon glyphicon-plus js-add-value"></a>
										{{#each values data_index}}
											{{#let value_Index=@index}}
												{{#if is_its_page}}
													<span style="color:#f00;" contenteditable="true" class="js-editable-value" data-data-index="{{data_index}}" data-value-index="{{value_Index}}">
														{{this.value}}
													</span>
												{{else}}
													{{this.value}}
												{{/if}}
												<a href="/cyoas/{{get_cyoaid}}/page/{{pageid}}">({{page_name}})</a>, 
<!-- 												 data-clicked="false" -->
<!--	{{> editableText context=../.. collection='cyoaParams' field=(get_value data_index value_Index)}}, -->
											{{/let}}
										{{/each}}
									</div>
								{{/let}}
							{{/each}}
							<p>
							<br>
								<a href="#" class="glyphicon glyphicon-plus js-add-data"></a>
							</p>
						{{/with}}
					</div>
				</div>
			</div>
		</div>
	</div>
</template>
<template name="paramlist">
	<div>
		{{#each param}}
<!-- 		<span class="js-page-choises css-page-choises {{readyORnot}}">{{title}}</span> -->
			<a href="#" class="js-paramItem">{{title}}, </a>
		{{/each}}
	</div>
</template>